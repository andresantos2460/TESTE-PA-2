<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Guia Mestre - Programação Avançada (ESTG)</title>
    <style>
        @media print {
            body { background-color: white !important; }
            .card { box-shadow: none !important; border: 1px solid #ddd !important; page-break-inside: avoid; }
            header { box-shadow: none !important; }
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; line-height: 1.5; color: #222; max-width: 1000px; margin: auto; padding: 15px; background-color: #f0f2f5; }
        header { background: #8b0000; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        h2 { background: #8b0000; color: white; padding: 10px 15px; border-radius: 5px; margin-top: 30px; font-size: 1.4em; }
        h3 { color: #8b0000; border-bottom: 2px solid #8b0000; padding-bottom: 5px; margin-top: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(45%, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-top: 4px solid #8b0000; }
        code { background: #fff3f3; color: #d32f2f; padding: 2px 5px; border-radius: 4px; font-family: 'Consolas', monospace; font-weight: bold; }
        pre { background: #1e1e1e; color: #dcdcdc; padding: 15px; overflow-x: auto; border-radius: 6px; font-size: 0.9em; border-left: 5px solid #8b0000; }
        .important { background: #fff9c4; border-left: 6px solid #fbc02d; padding: 12px; margin: 15px 0; border-radius: 4px; font-weight: 500; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f2f2f2; color: #8b0000; }
        .method { color: #2e7d32; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>Programação Avançada: Sebenta de Exame</h1>
    <p>Comunicações UDP, Manipulação de Bits, Strings e Memória</p>
</header>

<section>
    <h2>1. Comunicações UDP e Estruturas</h2>
    <div class="important">
        <strong>Regra de Ouro:</strong> Sempre que enviares ou receberes estruturas via rede, usa <code>__attribute__((packed))</code> para evitar falhas de alinhamento de memória.
    </div>
    
    <div class="card">
        <h3>Definição da Mensagem</h3>
        <pre>
typedef struct __attribute__((__packed__)) {
    uint8_t  op;           // 1 byte
    uint32_t id_estudante; // 4 bytes (necessita htonl/ntohl)
    uint16_t porto;        // 2 bytes (necessita htons/ntohs)
} msg_t;</pre>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Enviar (Cliente)</h3>
            <pre>
msg_t m;
m.op = 1;
m.id_estudante = htonl(2190000);
m.porto = htons(9999);

sendto(sock, &m, sizeof(m), 0, 
      (struct sockaddr*)&serv_addr, 
       sizeof(serv_addr));</pre>
        </div>
        <div class="card">
            <h3>Receber (Servidor)</h3>
            <pre>
msg_t m;
struct sockaddr_in cli;
socklen_t len = sizeof(cli);

recvfrom(sock, &m, sizeof(m), 0,
         (struct sockaddr*)&cli, &len);

uint32_t id = ntohl(m.id_estudante);</pre>
        </div>
    </div>
</section>

<section>
    <h2>2. Manipulação de Bits (Bitwise)</h2>
    <p>Essencial para verificar estados de sensores ou flags de configuração.</p>

    <div class="card">
        <h3>Operações Rápidas (Bit na posição <code>n</code>)</h3>
        <table>
            <tr>
                <th>Operação</th>
                <th>Código C</th>
                <th>Explicação</th>
            </tr>
            <tr>
                <td><span class="method">Verificar</span></td>
                <td><code>(valor & (1 << n))</code></td>
                <td>Resultado é > 0 se o bit estiver a 1.</td>
            </tr>
            <tr>
                <td><span class="method">Ativar (Set)</span></td>
                <td><code>valor |= (1 << n)</code></td>
                <td>Força o bit <code>n</code> a ser 1.</td>
            </tr>
            <tr>
                <td><span class="method">Desativar (Clear)</span></td>
                <td><code>valor &= ~(1 << n)</code></td>
                <td>Força o bit <code>n</code> a ser 0.</td>
            </tr>
            <tr>
                <td><span class="method">Inverter (Flip)</span></td>
                <td><code>valor ^= (1 << n)</code></td>
                <td>Troca 0 por 1 e vice-versa.</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3>Visualização Binária (Impressão)</h3>
        <pre>
void print_bits(uint8_t v) {
    for(int i = 7; i >= 0; i--) {
        printf("%d", (v >> i) & 1);
    }
    printf("\n");
}</pre>
    </div>
</section>

<section>
    <h2>3. Manipulação de Strings e Comandos</h2>
    <div class="grid">
        <div class="card">
            <h3><span class="method">sscanf</span> - Extrair dados</h3>
            <p>Lê de uma string em vez do teclado.</p>
            <pre>
char input[] = "IP:192.168.1.1,PORT:8080";
char ip[20];
int port;
sscanf(input, "IP:%[^,],PORT:%d", ip, &port);</pre>
        </div>
        <div class="card">
            <h3><span class="method">sprintf</span> - Montar Strings</h3>
            <p>Útil para criar comandos para a função <code>system()</code>.</p>
            <pre>
char cmd[256];
char cor[] = "#FF5733";
sprintf(cmd, "convert -size 100x100 xc:%s imagem.png", cor);
system(cmd); // Executa no terminal</pre>
        </div>
    </div>
    
    <div class="card" style="border-top: 4px solid #2e7d32;">
        <h3><span class="method">strncat</span> e <span class="method">strncpy</span> - Segurança</h3>
        <p>Sempre preferir versões com <code>n</code> para evitar Buffer Overflow.</p>
        <pre>
char dest[50] = "Olá ";
char src[] = "Mundo da Programação";
strncat(dest, src, sizeof(dest) - strlen(dest) - 1); 
// Garante que não escreve fora do array</pre>
    </div>
</section>

<section>
    <h2>4. Validações de Rede e Erros</h2>
    <div class="card">
        <h3>Validação de IP (Presentation to Network)</h3>
        <pre>
#include &lt;arpa/inet.h&gt;
struct in_addr addr;
if (inet_pton(AF_INET, args.ip_arg, &addr) != 1) {
    // IP Inválido!
}</pre>
    </div>

    <div class="important">
        <strong>Lógica de Servidor UDP:</strong> 
        Ao validar pacotes, se um dado estiver fora de gama (ex: nota > 20), deves enviar uma resposta de erro ao cliente e usar o comando <code>continue;</code> para voltar ao início do <code>while(1)</code> sem processar o resto.
    </div>
</section>

<section>
    <h2>5. Tabela de Formatação (printf)</h2>
    <table>
        <thead>
            <tr>
                <th>Especificador</th>
                <th>Tipo</th>
                <th>Exemplo / Uso</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>%02x</code></td>
                <td>Hexadecimal</td>
                <td><code>0a</code> (Sempre 2 dígitos, minúsculo). Ideal para cores.</td>
            </tr>
            <tr>
                <td><code>%X</code></td>
                <td>Hexadecimal</td>
                <td><code>1A2B</code> (Maiúsculas). Ideal para debug de endereços.</td>
            </tr>
            <tr>
                <td><code>%u</code></td>
                <td>Unsigned Int</td>
                <td><code>uint32_t</code> (Sempre positivo).</td>
            </tr>
            <tr>
                <td><code>%zu</code></td>
                <td>size_t</td>
                <td>Usado para o retorno de <code>sizeof()</code> ou <code>strlen()</code>.</td>
            </tr>
        </tbody>
    </table>
</section>

<footer style="margin-top: 30px; text-align: center; font-size: 0.8em; color: #777; border-top: 1px solid #ccc; padding-top: 10px;">
    Guia Prático ESTG - Programação Avançada. Boa sorte no exame!
</footer>

</body>
</html>
